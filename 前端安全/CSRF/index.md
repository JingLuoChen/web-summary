# CSRF攻击
## 概述
CSRF（Cross-Site Request Forgery）- 跨站请求伪造

攻击者诱导受害者进入第三方网站，在第三方网站中，向被攻击网站发送跨站请求，利用受害者在被攻击网站已经获取的注册凭证，
绕过后台的用户验证，达到冒充用户对被攻击的网站执行某项操作的目的

## CSRF攻击流程

```$xslt
* 受害者登录a.com, 并保留了登录凭证
* 攻击者引诱受害者访问了b.com
* b.com 向 a.com发送了一个请求：a.com/act=xx 浏览器会默认携带a.com的cookie
* a.com 接受到请求后，对请求进行验证，并确认是受害者的凭证，误以为是受害者自己发送的请求
* a.com以受害者的名义执行了act=xx
* 攻击完成，攻击者在受害者不知道的情况下，冒充受害者，让a.com执行了自己定义的操作
```
 
## CSRF可以做什么
可以理解CSRF攻击：攻击者盗用了你的身份，以你的名义发送恶意请求。CSRF能够做的事情包括：以你名义发送邮件，发消息，盗取你的账号，甚至购买商品，虚拟货币转账。。。

## CSRF的特点

* 攻击一般发起在第三方网站，而不是被攻击的网站。被攻击的网站无法防止攻击发生
* 攻击利用受害者在被攻击网站的登录凭证，冒充受害者提交操作，而不是直接窃取数据
* 整个过程攻击者并不能获取到受害的登录凭证，仅仅是'冒用'
* 跨站请求可以用各种方式：图片URl、超链接、CORS、Form提交等等，部分请求方式可以直接嵌入在第三方论坛、文章中，难以进行追踪

CSRF通常是跨域的，因为外域通常更容易被攻击者掌控，但是如果本域下有容易被利用的功能，比如可以发图和链接的论坛和评论区，攻击可以直接在本域下进行，而且这种攻击更加危险

## 几种常见的攻击类型
### get类型的CSRF
### post类型的CSRF
### 链接类型的CSRF

## 防护策略
针对CSRF的两个特点
* CSRF通常发生在第三方域名
* CSRF攻击者不能获取到Cookie

专门制定的防护策略
* 阻止不明外域的访问
同源检测、Samesite Cookie
* 提交时要求附加本域才能获取的信息
CSRF Token、双重Cookie验证

### 验证HTTP Referer字段
```$xslt
根据HTTP协议，在HTTP头中有一个字段叫Referer，它记录了该HTTP请求的来源地址，在通常情况下，访问一个安全受限页面的请求来自于同一个网站。
这种方法的好处是简单易行，但并非万无一失，Referer是浏览器提供的，虽然HTTP协议上有明确的要求，但是每个浏览器对于Referer的具体实现可能有差别，
并不能保证浏览器自身没有安全漏洞。使用验证Referer值的方法，就是把安全性都依赖于第三方来保证
```
### 在请求地址中添加token验证
```$xslt
CSRF攻击之所以能够成功，是因为黑客可以完全伪造用户的请求，该请求中所有的用户验证信息都是存在于cookie中，因为黑客可以在不知道这些验证信息的情况下直接利用用户
自己的cookie来通过安全验证。要防御CSRF，关键在于在请求中放入黑客所不能伪造的信息，并且该信息不存在于cookie中，可以在HTTP请求中以参数的形式加入一个随机产生的token，
并在服务器端建立一个拦截器来验证这个token，如果请求中没有token或者token内容不正确，则认为可能是CSRF攻击而拒绝该请求
```
* 但此方法的缺点是难以保证token本身的安全。
### 在HTTP头中自定义属性并验证
```$xslt
这种方法也是使用 token 并进行验证，和上一种方法不同的是，这里并不是把 token 以参数的形式置于 HTTP 请求之中，而是把它放到 HTTP 头中自定义的属性里。
通过 XMLHttpRequest 这个类，可以一次性给所有该类请求加上 csrftoken 这个 HTTP 头属性，并把 token 值放入其中。这样解决了上种方法在请求中加入 token 的不便，
同时，通过 XMLHttpRequest 请求的地址不会被记录到浏览器的地址栏，也不用担心 token 会透过 Referer 泄露到其他网站中去。
```

## 参考文档
* [浅谈CSRF攻击方式](https://www.cnblogs.com/hyddd/archive/2009/04/09/1432744.html)
* [浅谈 CSRF 攻击方式](https://juejin.im/entry/6844903461293654024)
